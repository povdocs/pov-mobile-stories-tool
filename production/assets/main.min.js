function createCORSRequest(e,t){var n=new XMLHttpRequest;return"withCredentials"in n?n.open(e,t,!0):"undefined"!=typeof XDomainRequest?(n=new XDomainRequest,n.open(e,t)):n=null,n}function AssetManager(){this.DEBUG=!0,this.successCount=0,this.errorCount=0,this.cache={},this.downloadQueue=[],this.inQueue={}}AssetManager.prototype.queueDownload=function(e){this.downloadQueue.push(e)},AssetManager.prototype.constructor=function(e,t){"undefined"!=typeof e&&(this.downloadQueue=e),0===this.downloadQueue.length&&"undefined"!=typeof t&&t();for(var n=this,o=0;o<this.downloadQueue.length;o++){var a=this.downloadQueue[o];if("image"==a.type)this.downloadImage(a.path,function(e,o){n.cache[e]=o,n.isDone()&&t()});else if("audio"==a.type)this.downloadAudio(a.path,function(e,o){n.cache[e]=o,n.isDone()&&t()});else{if("video"!=a.type)continue;this.downloadVideo(a.path,function(e,o){n.cache[e]=o,n.isDone()&&t()})}}},AssetManager.prototype.downloadImage=function(e,t){var n=new Image,o=this;o.DEBUG&&console.log("IMAGE DOWNLOADING: ",e),n.addEventListener("progress",function(t){o.progressCount(e,t.loaded,t.total)}),n.addEventListener("load",function(){o.successCount+=1,o.DEBUG&&console.log("IMAGE DOWNLOADED: ",e),t(e,n)},!1),n.addEventListener("error",function(){o.errorCount+=1},!1),n.src=e},AssetManager.prototype.downloadAudio=function(e,t){var n=new Audio,o=this;o.DEBUG&&console.log("AUDIO DOWNLOADING: ",e),n.addEventListener("progress",function(t){o.DEBUG&&console.log("AUDIO progress: ",e,t),o.progressCount(e,t.loaded,t.total)}),n.addEventListener("load",function(){o.DEBUG&&console.log("AUDIO DOWNLOADED: ",e),o.successCount+=1,t(e,n)},!1),n.addEventListener("error",function(){o.DEBUG&&console.error("AUDIO: ",e),o.errorCount+=1},!1),n.src=e,n.muted=!0,n.volume=0,n.autoplay=!1},AssetManager.prototype.downloadVideo=function(e,t){var n=null,o=this,a=createCORSRequest("GET",e);if(!a)throw new Error("CORS not supported");o.DEBUG&&console.log("VIDEO DOWNLOADING: ",e),a.responseType="blob",a.addEventListener("progress",function(t){o.progressCount(e,t.loaded,t.total)}),a.addEventListener("load",function(){o.DEBUG&&console.log("VIDEO DOWNLOADED: ",e),o.successCount+=1,window.URL=window.URL||window.webkitURL,n=window.URL.createObjectURL(this.response),t(e,n)},!1),a.addEventListener("error",function(){o.errorCount+=1},!1),a.send()},AssetManager.prototype.isDone=function(){return!(this.progress()<100)},AssetManager.prototype.progress=function(){var e=0,t=0;for(var n in this.inQueue)this.inQueue.hasOwnProperty(n)&&(e+=this.inQueue[n].progress,t+=this.inQueue[n].total);return Math.round(e/t*100)},AssetManager.prototype.getAsset=function(e){return this.cache.hasOwnProperty(e)?this.cache[e]:e},AssetManager.prototype.updateProgress=function(e,t){if(t.lengthComputable){var n=t.loaded/t.total;parentThis.DEBUG&&console.log(e,n)}},AssetManager.prototype.progressCount=function(e,t,n){this.inQueue[e]={progress:event.loaded,total:event.total}};var assetManager=new AssetManager,app={DEBUG:!0,snapFile:"assets/snap.json",touchX:null,touchY:null,video:null,audio:null,currentScroll:0,currentSnap:0,assets:[],allAssets:[],snaps:[],started:!1,title:document.title,width:$("main").width(),init:function(){app.readFile(),app.start()},start:function(){setTimeout(function(){app.eventListener(),app.downloadAssets(),app.snap.init()},1e3)},readFile:function(){$.getJSON(app.snapFile,function(e){for(var t=0,n=e.length;t<n;t++)app.snap.create(t,e[t]),app.snap.index(t)})},eventListener:function(){$("#snap0,.intro").on("click",function(){if(app.DEBUG&&console.log("intro click."),!app.started){app.toggleFullScreen(),app.started=!0;for(var e=0,t=app.snaps.length;e<t;e++){var n=app.snaps[e];n.video.length&&(app.playMedia(n.video,!1),setTimeout(function(){app.stopMedia(n.video)},5e3)),n.audio.length&&(app.playMedia(n.audio,!1),setTimeout(function(){app.stopMedia(n.audio)},5e3))}}app.snap.next()}),$(document).on("keydown",function(e){37==e.keyCode?app.snap.previous():38==e.keyCode?app.snap.cover.show(!0):39==e.keyCode?app.snap.next():40==e.keyCode&&app.snap.content.show()}).on("touchstart",function(e){}).on("touchmove",function(e){}).on("touchend",function(e){})},addAssetManager:function(e,t){var n=app.assets.indexOf(t);return n<0?(app.allAssets.push({type:e,path:t}),app.assets.push(t),app.allAssets.length-1):n},downloadAssets:function(){var e=setInterval(function(){var t=assetManager.progress();t<100?($("#progress-bar").css({width:t+"%"}),document.title=t+"% | "+app.title):(clearInterval(e),document.title=app.title)},500);assetManager.constructor(app.allAssets,function(){for(var e=0;e<app.allAssets.length;e++){var t=app.allAssets[e],n=assetManager.getAsset(t.path);if("audio"==t.type||"video"==t.type)$('[data-asset-id="'+e+'"]').each(function(){$(this).get(0).src=n,$(this).children().get(0).src=n});else{if("image"!=t.type)continue;$('[data-asset-id="'+e+'"]').attr("src",t.path)}}$("#launcher").hide(),app.snap.play(app.snap.getCurrent())})},getScroll:function(){var e=app.currentScroll,t=$("main").width();return e=e<0?0:e,e%t!==0&&(e-=e%t),e},stopMedia:function(e){return!!e&&void e.animate({volume:0},500,function(){e.get(0).pause(),e.get(0).currentTime=0,e.get(0).volume=0,e.prop("muted",!0)})},playMedia:function(e,t){return!!e&&(e.prop("muted",t===!1),e.get(0).currentTime=0,e.get(0).volume=1,void e.get(0).play())},toggleFullScreen:function(){var e=document.documentElement;document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}};app.snap={init:function(){app.snap.cover.eventListeners(),app.snap.content.eventListeners()},create:function(e,t){var n="";n=0==e?$('<section id="snap'+e+'" class="intro"></section>'):$('<section id="snap'+e+'" class="snap"></section>');var o=$('<div class="snap-cover"></div>');if(t.cover.video?o.append('<video class="snap-cover-video" data-asset-id="'+app.addAssetManager("video",t.cover.video)+'" loop muted><source src="" type="video/mp4"></video>'):(t.cover.image&&o.append('<img class="snap-cover-image" data-asset-id="'+app.addAssetManager("image",t.cover.image)+'" src="" alt="" width="100%" height="">'),t.cover.audio&&o.append('<audio class="snap-cover-audio" loop muted><source src="'+t.cover.audio+'" type="audio/mp3"></audio>')),o.appendTo(n),e>0){var a=$('<div class="snap-content"></div>');"html"==t.content.type&&a.html(t.content.src),"video"==t.content.type&&a.append('<video class="snap-content-video" preload="metadata" controls><source src="'+t.content.src+'" type="video/mp4"></video>'),a.addClass(t.content.type),a.appendTo(n)}n.appendTo("main")},index:function(e){var t={video:$("#snap"+e+" .snap-cover video"),audio:$("#snap"+e+" .snap-cover audio"),cover:$("#snap"+e+" .snap-cover"),content:$("#snap"+e+" .snap-content")};app.snaps.push(t)},getCurrent:function(){return app.currentSnap<0&&(app.currentSnap=0),app.snap.get(app.currentSnap)},get:function(e){return e<0||e>app.snaps.length?null:app.snaps[e]},next:function(){var e=app.width,t=$("section.snap").length,n=app.getScroll()+e;app.snap.cover.show(!1),n<=e*t&&$("main").stop().animate({scrollLeft:n},500,function(){var t=n/e;app.currentScroll=n,app.currentSnap=t,app.snap.stop(app.snap.get(t-1)),app.snap.play(app.snap.get(t))})},previous:function(){var e=app.width,t=app.getScroll()-e;app.snap.cover.show(!1),t>=0&&$("main").stop().animate({scrollLeft:t},500,function(){var n=t/e;app.currentScroll=t,app.currentSnap=n,app.snap.stop(app.snap.get(n+1)),app.snap.play(app.snap.get(n))})},play:function(e){return!!e&&(e.video.length&&app.playMedia(e.video,!0),void(e.audio.length&&app.playMedia(e.audio,!0)))},stop:function(e){return!!e&&(e.video.length&&app.stopMedia(e.video),void(e.audio.length&&app.stopMedia(e.audio)))},content:{show:function(){var e=app.snap.getCurrent();return!!e.content.html()&&(e.cover.addClass("over"),app.snap.stop(e),void(e.content.find(".snap-content-video").length&&e.content.find(".snap-content-video").each(function(){$(this).get(0).volume=1,$(this).prop("muted",!1),$(this).get(0).play()})))},stop:function(e){return e||(e=app.snap.getCurrent()),!!e.content.html()&&void e.content.find("video,audio").each(function(){var e=$(this);e.animate({volume:0},500,function(){e.get(0).pause(),e.get(0).currentTime=0})})},eventListeners:function(){$(".snap-content").on("mousedown",function(e){app.touchX=e.clientX,app.touchY=e.clientY}).on("mousemove",function(e){if(app.touchX&&app.touchY){var t=app.touchX-e.clientX,n=app.touchY-e.clientY;app.touchX=null,app.touchY=null,app.snap.content.swipe(t,n,$(this).scrollTop())}}).on("touchstart",function(e){app.touchX=e.originalEvent.touches[0].clientX,app.touchY=e.originalEvent.touches[0].clientY}).on("touchmove",function(e){if(app.touchX&&app.touchY){var t=app.touchX-e.originalEvent.touches[0].clientX,n=app.touchY-e.originalEvent.touches[0].clientY;app.touchX=null,app.touchY=null,app.snap.content.swipe(t,n,$(this).scrollTop())}})},swipe:function(e,t,n){e&&t&&(Math.abs(e)>Math.abs(t)?e<0?(app.DEBUG&&console.log("content swipe left"),app.snap.previous()):(app.DEBUG&&console.log("content swipe right"),app.snap.next()):t<0?(app.DEBUG&&console.log("content swipe up"),n<2&&app.snap.cover.show(!0)):app.DEBUG&&console.log("content swipe down"))}},cover:{show:function(e){var t=app.snap.getCurrent();!t.content.html()&&t.cover.hasClass("over")?(t.cover.removeClass("over"),e===!0&&app.snap.play(t)):(app.snap.content.stop(t),t.content.stop().animate({scrollTop:0},500,function(){t.cover.removeClass("over"),e===!0&&app.snap.play(t)}))},eventListeners:function(){$(".snap-cover").on("mousedown",function(e){app.touchX=e.clientX,app.touchY=e.clientY}).on("mousemove",function(e){if(app.touchX&&app.touchY){var t=app.touchX-e.clientX,n=app.touchY-e.clientY;app.touchX=null,app.touchY=null,app.snap.cover.swipe(t,n)}}).on("touchstart",function(e){app.touchX=e.originalEvent.touches[0].clientX,app.touchY=e.originalEvent.touches[0].clientY}).on("touchmove",function(e){if(app.touchX&&app.touchY){var t=app.touchX-e.originalEvent.touches[0].clientX,n=app.touchY-e.originalEvent.touches[0].clientY;app.touchX=null,app.touchY=null,app.snap.cover.swipe(t,n)}})},swipe:function(e,t){e&&t&&(Math.abs(e)>Math.abs(t)?e<0?(app.DEBUG&&console.log("swipe left"),app.snap.previous()):(app.DEBUG&&console.log("swipe right"),app.snap.next()):t<0?app.DEBUG&&console.log("swipe up"):(app.DEBUG&&console.log("swipe down"),app.snap.content.show()))}}},$(document).ready(function(){app.init()});
//# sourceMappingURL=main.min.js.map
