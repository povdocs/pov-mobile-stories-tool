function createCORSRequest(e,t){var n=new XMLHttpRequest;return"withCredentials"in n?n.open(e,t,!0):"undefined"!=typeof XDomainRequest?(n=new XDomainRequest,n.open(e,t)):n=null,n}function AssetManager(){this.DEBUG=!0,this.successCount=0,this.errorCount=0,this.cache={},this.downloadQueue=[],this.inQueue={}}AssetManager.prototype.queueDownload=function(e){this.downloadQueue.push(e)},AssetManager.prototype.constructor=function(e,t){"undefined"!=typeof e&&(this.downloadQueue=e),0===this.downloadQueue.length&&"undefined"!=typeof t&&t();for(var n=this,o=0;o<this.downloadQueue.length;o++){var a=this.downloadQueue[o];if("image"==a.type)this.downloadImage(a.path,function(e,o){n.cache[e]=o,n.isDone()&&t()});else if("audio"==a.type)this.downloadAudio(a.path,function(e,o){n.cache[e]=o,n.isDone()&&t()});else{if("video"!=a.type)continue;this.downloadVideo(a.path,function(e,o){n.cache[e]=o,n.isDone()&&t()})}}},AssetManager.prototype.downloadImage=function(e,t){var n=new Image,o=this;o.DEBUG&&console.log("IMAGE DOWNLOADING: ",e),n.addEventListener("progress",function(t){o.progressCount(e,t.loaded,t.total)}),n.addEventListener("load",function(){o.successCount+=1,o.DEBUG&&console.log("IMAGE DOWNLOADED: ",e),t(e,n)},!1),n.addEventListener("error",function(){o.errorCount+=1},!1),n.src=e},AssetManager.prototype.downloadAudio=function(e,t){var n=new Audio,o=this,a=createCORSRequest("GET",e);if(!a)throw new Error("CORS not supported");o.DEBUG&&console.log("AUDIO DOWNLOADING: ",e),a.responseType="blob",a.addEventListener("progress",function(t){o.progressCount(e,t.loaded,t.total)}),a.addEventListener("load",function(){o.DEBUG&&console.log("AUDIO DOWNLOADED: ",e),o.successCount+=1,window.URL=window.URL||window.webkitURL,n=window.URL.createObjectURL(this.response),t(e,n)},!1),a.addEventListener("error",function(){o.errorCount+=1},!1),a.send()},AssetManager.prototype.downloadVideo=function(e,t){var n=null,o=this,a=createCORSRequest("GET",e);if(!a)throw new Error("CORS not supported");o.DEBUG&&console.log("VIDEO DOWNLOADING: ",e),a.responseType="blob",a.addEventListener("progress",function(t){o.progressCount(e,t.loaded,t.total)}),a.addEventListener("load",function(){o.DEBUG&&console.log("VIDEO DOWNLOADED: ",e),o.successCount+=1,window.URL=window.URL||window.webkitURL,n=window.URL.createObjectURL(this.response),t(e,n)},!1),a.addEventListener("error",function(){o.errorCount+=1},!1),a.send()},AssetManager.prototype.isDone=function(){return!(this.progress()<100)},AssetManager.prototype.progress=function(){var e=0,t=0;for(var n in this.inQueue)this.inQueue.hasOwnProperty(n)&&(e+=this.inQueue[n].progress,t+=this.inQueue[n].total);return Math.round(e/t*100)},AssetManager.prototype.getAsset=function(e){return this.cache.hasOwnProperty(e)?this.cache[e]:e},AssetManager.prototype.updateProgress=function(e,t){if(t.lengthComputable){var n=t.loaded/t.total;parentThis.DEBUG&&console.log(e,n)}},AssetManager.prototype.progressCount=function(e,t,n){this.inQueue[e]={progress:event.loaded,total:event.total}};var assetManager=new AssetManager,app={DEBUG:!0,snapFile:"assets/snap.json",touchX:null,touchY:null,currentScroll:0,currentSnap:0,assets:[],allAssets:[],data:[],snaps:[],startedTF:!1,loadedTF:!1,title:document.title,width:$("main").width(),swipeThreshold:6,init:function(){app.readFile(app.downloadAssets)},readFile:function(e){$.getJSON(app.snapFile,function(t){app.data=t;for(var n=0,o=null,a=t.length;n<a;n++)o=t[n],o.cover&&(o.cover.image&&app.addAssetManager("image",o.cover.image),o.cover.audio&&app.addAssetManager("audio",o.cover.audio),o.cover.video&&app.addAssetManager("video",o.cover.video)),o.content&&"video"==o.content.type&&app.addAssetManager("video",o.content.src),n==a-1&&e()})},addAssetManager:function(e,t){var n=app.assets.indexOf(t);return n<0?(app.allAssets.push({type:e,path:t}),app.assets.push(t),app.allAssets.length-1):n},downloadAssets:function(){assetManager.constructor(app.allAssets,function(){for(var e=0,t=null,n=app.data.length;e<n;e++)t=app.data[e],t.cover&&(t.cover.audio&&(t.cover.audio=assetManager.getAsset(t.cover.audio)),t.cover.video&&(t.cover.video=assetManager.getAsset(t.cover.video))),t.content&&"video"==t.content.type&&(t.content.src=assetManager.getAsset(t.content.src));app.start()});var e=setInterval(function(){var t=assetManager.progress();t<100?($("#progress-bar").css({width:t+"%"}),document.title=t+"% | "+app.title):(clearInterval(e),document.title=app.title)},1e3)},start:function(){if(!app.loadedTF)for(var e=0,t=app.data.length;e<t;e++)app.snap.create(e,app.data[e]),e==t-1&&(app.loadedTF=!0);var n=setInterval(function(){app.loadedTF&&($("#launcher").hide(),app.eventListener(),app.snap.init(),app.snap.play(app.snap.getCurrent()),clearInterval(n))},1e3)},eventListener:function(){$("#snap0,.intro").on("click",function(){if(app.DEBUG&&console.log("intro click."),!app.startedTF){app.toggleFullScreen(),app.startedTF=!0;for(var e=0,t=null,n=app.snaps.length;e<n;e++)t=app.snaps[e],t.video&&app.preload(t.video[0]),t.audio&&app.preload(t.audio[0])}app.snap.next()}),$(document).on("keydown",function(e){37==e.keyCode?app.snap.previous():38==e.keyCode?app.snap.cover.show(!0):39==e.keyCode?app.snap.next():40==e.keyCode&&app.snap.content.show()})},getScroll:function(){var e=app.currentScroll,t=$("main").width();return e=e<0?0:e,e%t!==0&&(e-=e%t),e},stopMedia:function(e){return!!e&&void $(e).animate({volume:0},500,function(){e.pause(),e.currentTime=0,e.muted=!0})},playMedia:function(e,t){return!!e&&(e.muted=t===!1,e.currentTime=0,e.volume=1,void e.play())},preload:function(e){return!!e&&($(e).bind("canplaythrough",function(){$(e).get(0).play()}),$(e).bind("progress",function(e){this.duration>0&&console.log($(this).get(0).currentSrc,"Buffered: "+this.buffered.end(0)+"s")}),void($(e).get(0).volume=0))},toggleFullScreen:function(){var e=document.documentElement;document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}};app.snap={init:function(){app.snap.cover.eventListeners(),app.snap.content.eventListeners()},create:function(e,t){var n=document.getElementById("main"),o="",a={video:null,audio:null,image:null,cover:null,content:null,contentVideo:null};0==e?(o=document.createElement("section"),o.setAttribute("class","intro")):(o=document.createElement("section"),o.setAttribute("class","snap")),o.setAttribute("id","snap"+e);var p=document.createElement("div");if(p.setAttribute("class","snap-cover"),t.cover.video){var s=document.createElement("video");s.setAttribute("webkit-playsinline",!0),s.setAttribute("src",t.cover.video),s.setAttribute("preload","metadata"),s.setAttribute("loop",!0),s.setAttribute("muted",!0),s.setAttribute("controls",!0),s.setAttribute("class","snap-cover-video"),p.appendChild(s),a.video=s}else{if(t.cover.image){var r=document.createElement("img");r.setAttribute("src",t.cover.image),r.setAttribute("alt",""),r.setAttribute("width","100%"),r.setAttribute("height",""),r.setAttribute("class","snap-cover-image"),p.appendChild(r),a.image=r}if(t.cover.audio){var i=document.createElement("audio");i.setAttribute("src",t.cover.audio),i.setAttribute("preload","metadata"),i.setAttribute("loop",!0),i.setAttribute("muted",!0),i.setAttribute("controls",!1),i.setAttribute("class","snap-cover-audio"),p.appendChild(i),a.audio=i}}if(o.appendChild(p),a.cover=p,e>0){var c=document.createElement("div");if(c.setAttribute("class","snap-content "+t.content.type),"html"==t.content.type&&(c.innerHTML=t.content.src),"video"==t.content.type){var s=document.createElement("video");s.setAttribute("webkit-playsinline",!0),s.setAttribute("src",t.content.src),s.setAttribute("preload","metadata"),s.setAttribute("loop",!1),s.setAttribute("muted",!1),s.setAttribute("controls",!0),s.setAttribute("class","snap-content-video"),c.appendChild(s),a.contentVideo=s}o.appendChild(c),a.content=c}n.appendChild(o),app.snaps.push(a)},getCurrent:function(){return app.currentSnap<0&&(app.currentSnap=0),app.snap.get(app.currentSnap)},get:function(e){return e<0||e>app.snaps.length?null:app.snaps[e]},next:function(){var e=app.width,t=$("section.snap").length,n=app.getScroll()+e;app.snap.cover.show(!1),n<=e*t&&$("main").stop().animate({scrollLeft:n},500,function(){var t=n/e;app.currentScroll=n,app.currentSnap=t,app.snap.stop(app.snap.get(t-1)),app.snap.play(app.snap.get(t))})},previous:function(){var e=app.width,t=app.getScroll()-e;app.snap.cover.show(!1),t>=0&&$("main").stop().animate({scrollLeft:t},500,function(){var n=t/e;app.currentScroll=t,app.currentSnap=n,app.snap.stop(app.snap.get(n+1)),app.snap.play(app.snap.get(n))})},play:function(e){return!!e&&void(e.video?app.playMedia(e.video,!0):e.audio&&app.playMedia(e.audio,!0))},stop:function(e){return!!e&&void(e.video?app.stopMedia(e.video):e.audio&&app.stopMedia(e.audio))},content:{show:function(){var e=app.snap.getCurrent();return!!e.content&&($(e.cover).addClass("over"),app.snap.stop(e),void(e.contentVideo&&(e.contentVideo.volume=1,e.contentVideo.muted=!1,e.contentVideo.play())))},stop:function(e){return e||(e=app.snap.getCurrent()),!!e.content&&void $(e.content).find("video,audio").each(function(){var e=$(this);e.animate({volume:0},500,function(){e.get(0).pause(),e.get(0).currentTime=0})})},eventListeners:function(){$(".snap-content").on("mousedown",function(e){app.started&&(app.touchX=e.clientX,app.touchY=e.clientY)}).on("mousemove",function(e){if(app.touchX&&app.touchY){var t=app.touchX-e.clientX,n=app.touchY-e.clientY;app.touchX=null,app.touchY=null,app.snap.content.swipe(t,n,$(this).scrollTop())}}).on("touchstart",function(e){app.started&&(app.touchX=e.originalEvent.touches[0].clientX,app.touchY=e.originalEvent.touches[0].clientY)}).on("touchmove",function(e){if(app.touchX&&app.touchY){var t=app.touchX-e.originalEvent.touches[0].clientX,n=app.touchY-e.originalEvent.touches[0].clientY;app.touchX=null,app.touchY=null,app.snap.content.swipe(t,n,$(this).scrollTop())}})},swipe:function(e,t,n){e&&t&&(Math.abs(e)>Math.abs(t)?e<0?e<-Math.abs(app.swipeThreshold)&&(app.DEBUG&&console.log("content swipe left"),app.snap.previous()):e>Math.abs(app.swipeThreshold)&&(app.DEBUG&&console.log("content swipe right"),app.snap.next()):t<0?t<-Math.abs(app.swipeThreshold)&&(app.DEBUG&&console.log("content swipe up"),n<2&&app.snap.cover.show(!0)):t>Math.abs(app.swipeThreshold)&&app.DEBUG&&console.log("content swipe down"))}},cover:{show:function(e){var t=app.snap.getCurrent();t.content?(app.snap.content.stop(t),$(t.content).stop().animate({scrollTop:0},500,function(){$(t.cover).removeClass("over"),e===!0&&app.snap.play(t)})):($(t.cover).removeClass("over"),e===!0&&app.snap.play(t))},eventListeners:function(){$(".snap-cover").on("mousedown",function(e){app.started&&(app.touchX=e.clientX,app.touchY=e.clientY)}).on("mousemove",function(e){if(app.touchX&&app.touchY){var t=app.touchX-e.clientX,n=app.touchY-e.clientY;app.touchX=null,app.touchY=null,app.snap.cover.swipe(t,n)}}).on("touchstart",function(e){app.started&&(app.touchX=e.originalEvent.touches[0].clientX,app.touchY=e.originalEvent.touches[0].clientY)}).on("touchmove",function(e){if(app.touchX&&app.touchY){var t=app.touchX-e.originalEvent.touches[0].clientX,n=app.touchY-e.originalEvent.touches[0].clientY;app.touchX=null,app.touchY=null,app.snap.cover.swipe(t,n)}})},swipe:function(e,t){e&&t&&(Math.abs(e)>Math.abs(t)?e<0?e<-Math.abs(app.swipeThreshold)&&(app.DEBUG&&console.log("swipe left"),app.snap.previous()):e>Math.abs(app.swipeThreshold)&&(app.DEBUG&&console.log("swipe right"),app.snap.next()):t<0?t<-Math.abs(app.swipeThreshold)&&app.DEBUG&&console.log("swipe up"):t>Math.abs(app.swipeThreshold)&&(app.DEBUG&&console.log("swipe down"),app.snap.content.show()))}}},$(document).ready(function(){app.init()});
//# sourceMappingURL=main.min.js.map
