function createCORSRequest(e,t){var n=new XMLHttpRequest;return"withCredentials"in n?n.open(e,t,!0):"undefined"!=typeof XDomainRequest?(n=new XDomainRequest,n.open(e,t)):n=null,n}function AssetManager(){this.DEBUG=!1,this.successCount=0,this.errorCount=0,this.cache={},this.downloadQueue=[],this.inQueue={}}AssetManager.prototype.queueDownload=function(e){this.downloadQueue.push(e)},AssetManager.prototype.constructor=function(e,t){"undefined"!=typeof e&&(this.downloadQueue=e),0===this.downloadQueue.length&&"undefined"!=typeof t&&t();for(var n=this,o=0;o<this.downloadQueue.length;o++){var a=this.downloadQueue[o];if("image"==a.type)this.downloadImage(a.path,function(e,o){n.cache[e]=o,n.isDone()&&t()});else if("audio"==a.type)this.downloadAudio(a.path,function(e,o){n.cache[e]=o,n.isDone()&&t()});else{if("video"!=a.type)continue;this.downloadVideo(a.path,function(e,o){n.cache[e]=o,n.isDone()&&t()})}}},AssetManager.prototype.downloadImage=function(e,t){var n=new Image,o=this;o.DEBUG&&console.log("IMAGE DOWNLOADING: ",e),n.addEventListener("progress",function(t){o.progressCount(e,t.loaded,t.total)}),n.addEventListener("load",function(){o.successCount+=1,o.DEBUG&&console.log("IMAGE DOWNLOADED: ",e),t(e,n)},!1),n.addEventListener("error",function(t){o.errorCount+=1,o.DEBUG&&console.error("ERROR DOWNLOADING IMAGE: ",e,t)},!1),n.src=e},AssetManager.prototype.downloadAudio=function(e,t){var n=new Audio,o=this,a=createCORSRequest("GET",e);if(!a)throw new Error("CORS not supported");o.DEBUG&&console.log("AUDIO DOWNLOADING: ",e),a.responseType="blob",a.addEventListener("progress",function(t){o.progressCount(e,t.loaded,t.total)}),a.addEventListener("load",function(){o.DEBUG&&console.log("AUDIO DOWNLOADED: ",e),o.successCount+=1,window.URL=window.URL||window.webkitURL,n=window.URL.createObjectURL(this.response),t(e,n)},!1),a.addEventListener("error",function(t){o.errorCount+=1,o.DEBUG&&console.error("ERROR DOWNLOADING AUDIO: ",e,t)},!1),a.send()},AssetManager.prototype.downloadVideo=function(e,t){var n=null,o=this,a=createCORSRequest("GET",e);if(!a)throw new Error("CORS not supported");o.DEBUG&&console.log("VIDEO DOWNLOADING: ",e),a.responseType="blob",a.addEventListener("progress",function(t){o.progressCount(e,t.loaded,t.total)}),a.addEventListener("load",function(){o.DEBUG&&console.log("VIDEO DOWNLOADED: ",e),o.successCount+=1,window.URL=window.URL||window.webkitURL,n=window.URL.createObjectURL(this.response),t(e,n)},!1),a.addEventListener("error",function(t){o.errorCount+=1,o.DEBUG&&console.error("ERROR DOWNLOADING VIDEO: ",e,t)},!1),a.send()},AssetManager.prototype.isDone=function(){return!(this.progress()<100)},AssetManager.prototype.progress=function(){var e=0,t=0;for(var n in this.inQueue)this.inQueue.hasOwnProperty(n)&&(e+=this.inQueue[n].progress,t+=this.inQueue[n].total);return Math.round(e/t*100)},AssetManager.prototype.getAsset=function(e){return this.cache.hasOwnProperty(e)?this.cache[e]:e},AssetManager.prototype.updateProgress=function(e,t){if(t.lengthComputable){var n=t.loaded/t.total;parentThis.DEBUG&&console.log(e,n)}},AssetManager.prototype.progressCount=function(e,t,n){this.inQueue[e]={progress:event.loaded,total:event.total}};var app={DEBUG:!1,snapFile:"assets/snap.json",assetManager:new AssetManager,touchX:null,touchY:null,currentScroll:0,currentSnap:0,assets:[],allAssets:[],data:[],snaps:[],startedTF:!1,loadedTF:!1,title:document.title,width:$("main").width(),swipeThreshold:6,cacheCover:!0,casheContent:!0,touchThreshold:40,transitionSpeed:600,init:function(){if(app.assetManager.DEBUG=app.DEBUG,app.readFile(app.downloadAssets),window.ui){var e=window.ui.os.replace(/\s/g,"");$("body").addClass(e.toLowerCase()),$("body").addClass(window.ui.browser.toLowerCase())}"standalone"in window.navigator&&window.navigator.standalone&&$("body").addClass("fullscreen")},readFile:function(e){$.getJSON(app.snapFile,function(t){app.data=t;for(var n=0,o=null,a=t.length;n<a;n++)o=t[n],o.cover&&app.cacheCover&&(o.cover.image&&app.addAssetManager("image",o.cover.image),o.cover.audio&&app.addAssetManager("audio",o.cover.audio),o.cover.video&&app.addAssetManager("video",o.cover.video)),o.content&&app.casheContent&&"video"==o.content.type&&app.addAssetManager("video",o.content.src),n==a-1&&e()})},addAssetManager:function(e,t){var n=app.assets.indexOf(t);return n<0?(app.allAssets.push({type:e,path:t}),app.assets.push(t),app.allAssets.length-1):n},downloadAssets:function(){app.assetManager.constructor(app.allAssets,function(){for(var e=0,t=null,n=app.data.length;e<n;e++)t=app.data[e],t.cover&&app.cacheCover&&(t.cover.audio&&(t.cover.audio=app.assetManager.getAsset(t.cover.audio)),t.cover.video&&(t.cover.video=app.assetManager.getAsset(t.cover.video))),t.content&&app.casheContent&&"video"==t.content.type&&(t.content.src=app.assetManager.getAsset(t.content.src));app.start()});var e=setInterval(function(){var t=app.assetManager.progress();t<100?($("#progress-bar").css({width:t+"%"}),document.title=t+"% | "+app.title):(clearInterval(e),document.title=app.title)},1e3)},start:function(){if(!app.loadedTF)for(var e=0,t=app.data.length;e<t;e++)app.snap.create(e,app.data[e]),e==t-1&&(app.loadedTF=!0);var n=setInterval(function(){app.loadedTF&&($("#launcher").hide(),app.eventListener(),app.snap.init(),app.snap.play(app.snap.getCurrent()),clearInterval(n))},1e3)},eventListener:function(){$(document).on("touchmove",function(e){var t=app.snap.getCurrent();$(t.content).hasClass("html")||e.preventDefault()}),$("#intro-play").on("click",function(){if(!app.startedTF){app.toggleFullScreen(),app.startedTF=!0;for(var e=0,t=null,n=app.snaps.length;e<n;e++)t=app.snaps[e],t.video&&app.preload(t.video),t.audio&&app.preload(t.audio),t.contentVideo&&app.preload(t.contentVideo)}app.snap.next()}),$("video,audio").bind("abort",function(e){app.DEBUG&&console.log(this.currentSrc,"abort function fired"),this.controls=!0}).bind("emptied",function(e){app.DEBUG&&console.log(this.currentSrc,"emptied function fired"),this.controls=!0}).bind("error",function(e){app.DEBUG&&console.log(this.currentSrc,"error function fired"),this.controls=!0}).bind("stalled",function(e){app.DEBUG&&console.log(this.currentSrc,"stalled function fired"),this.controls=!0}).bind("ended",function(e){app.DEBUG&&console.log(this.currentSrc,"ended function fired"),this.loop||(this.controls=!0)}).bind("pause",function(e){app.DEBUG&&console.log(this.currentSrc,"pause function fired"),this.volume=0}).bind("play",function(e){app.DEBUG&&console.log(this.currentSrc,"play function fired"),this.volume=1,this.tagName&&"VIDEO"===this.tagName&&$("body").hasClass("safari")&&$("body").hasClass("ios")&&$(this).attr("style","height: "+$("main").height()+"px")}).bind("playing",function(e){app.DEBUG&&console.log(this.currentSrc,"playing function fired"),$(this).parent().hasClass("snap-cover")&&(this.controls=!1)}),$(document).on("keydown",function(e){37==e.keyCode?app.snap.previous():38==e.keyCode?app.snap.cover.show(!0):39==e.keyCode?app.snap.next():40==e.keyCode&&app.snap.content.show()})},getScroll:function(){var e=app.currentScroll,t=$("main").width();return e=e<0?0:e,e%t!==0&&(e-=e%t),e},stopMedia:function(e){return!!e&&(e.pause(),void(e.currentTime=0))},playMedia:function(e){return!!e&&void e.play()},preload:function(e){return!!e&&(e.load(),e.play(),e.pause(),void(e.currentTime=0))},toggleFullScreen:function(){var e=document.documentElement;document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}};app.snap={init:function(){app.snap.cover.eventListeners(),app.snap.content.eventListeners()},create:function(e,t){var n=document.getElementById("main"),o="",a={video:null,audio:null,image:null,cover:null,content:null,contentVideo:null};if(o=document.createElement("section"),o.setAttribute("class",0===e?"intro":"snap"),o.setAttribute("id","snap"+e),0===e){if(t.cover.image)o.setAttribute("style","background-image: url('"+t.cover.image+"')");else{var s=document.createElement("img");s.setAttribute("src","assets/media/pov-logo-web-transparent-bg-white-text.svg"),s.setAttribute("alt","POV Logo"),s.setAttribute("width","200"),s.setAttribute("height","auto"),s.setAttribute("class","intro-pov-logo");var p=document.createElement("h1");p.setAttribute("class","intro-title"),p.innerHTML="Mobile Story Telling",o.appendChild(s),o.appendChild(p)}var r=document.createElement("button");r.setAttribute("type","button"),r.setAttribute("id","intro-play"),r.setAttribute("class","intro-play-btn"),r.innerHTML="Start",o.appendChild(r)}else{var i=document.createElement("div");if(i.setAttribute("class","snap-cover"),t.cover.video){var c=document.createElement("video");c.setAttribute("playsinline",!0),c.setAttribute("webkit-playsinline",!0),c.setAttribute("src",t.cover.video),c.setAttribute("preload","metadata"),c.setAttribute("loop",!0),c.setAttribute("controls",!1),c.setAttribute("class","snap-cover-video"),i.appendChild(c),a.video=c}else{if(t.cover.image){var l=document.createElement("img");l.setAttribute("src",t.cover.image),l.setAttribute("alt",""),l.setAttribute("width","100%"),l.setAttribute("height",""),l.setAttribute("class","snap-cover-image"),i.appendChild(l),a.image=l}if(t.cover.audio){var u=document.createElement("audio");u.setAttribute("src",t.cover.audio),u.setAttribute("preload","metadata"),u.setAttribute("loop",!0),u.setAttribute("controls",!1),u.setAttribute("class","snap-cover-audio"),i.appendChild(u),a.audio=u}}if(o.appendChild(i),a.cover=i,e>0&&""!==t.content.type&&""!==t.content.src){var d=document.createElement("article");if(d.setAttribute("class","snap-content "+t.content.type),"html"==t.content.type&&(d.innerHTML=t.content.src),"video"==t.content.type){var h=document.createElement("video");h.setAttribute("playsinline",!0),h.setAttribute("webkit-playsinline",!0),h.setAttribute("src",t.content.src),h.setAttribute("preload","metadata"),h.setAttribute("loop",!1),h.setAttribute("controls",!0),h.setAttribute("class","snap-content-video"),d.appendChild(h),a.contentVideo=h}o.appendChild(d),t.content.type&&($(o).addClass("content-more"),$(o).addClass(t.content.type)),a.content=d}}n.appendChild(o),app.snaps.push(a)},getCurrent:function(){return app.currentSnap<0&&(app.currentSnap=0),app.snap.get(app.currentSnap)},get:function(e){return e<0||e>app.snaps.length?null:app.snaps[e]},next:function(){var e=app.width,t=$("section.snap").length,n=app.getScroll()+e;app.snap.cover.show(!1),n<=e*t&&$("main").stop().animate({scrollLeft:n},app.transitionSpeed,function(){var t=n/e;app.currentScroll=n,app.currentSnap=t,app.snap.stop(app.snap.get(t-1)),app.snap.play(app.snap.get(t))})},previous:function(){var e=app.width,t=app.getScroll()-e;app.snap.cover.show(!1),t>=0&&$("main").stop().animate({scrollLeft:t},app.transitionSpeed,function(){var n=t/e;app.currentScroll=t,app.currentSnap=n,app.snap.stop(app.snap.get(n+1)),app.snap.play(app.snap.get(n))})},play:function(e){return!!e&&void(e.video?app.playMedia(e.video):e.audio&&app.playMedia(e.audio))},stop:function(e){return!!e&&void(e.video?app.stopMedia(e.video):e.audio&&app.stopMedia(e.audio))},content:{show:function(){var e=app.snap.getCurrent();return!(!e.content||$(e.cover).hasClass("over"))&&($(e.cover).animate({top:"-110%"},app.transitionSpeed,function(){$(this).addClass("over")}),app.snap.stop(e),void(e.contentVideo&&app.playMedia(e.contentVideo)))},stop:function(e){return e||(e=app.snap.getCurrent()),!!e.content&&void $(e.content).find("video,audio").each(function(){app.stopMedia(this)})},eventListeners:function(){$(".snap-content").on("touchstart",function(e){app.startedTF&&(app.touchX=e.originalEvent.touches[0].clientX,app.touchY=e.originalEvent.touches[0].clientY,app.mainScroll=app.getScroll())}).on("touchmove",function(e){if(app.touchX||app.touchY){var t=app.touchX-e.originalEvent.touches[0].clientX,n=app.touchY-e.originalEvent.touches[0].clientY;if(Math.abs(t)>Math.abs(n))$("main").scrollLeft(app.getScroll()+t);else{var o=app.snap.getCurrent();o.content&&$(o.cover).hasClass("over")&&n<0&&0===$(o.content).scrollTop()&&(n=(n+$("main").height())/$("main").height()*100,$(o.cover).css({top:n*-1+"%"}))}}}).on("touchend",function(e){if(app.touchX||app.touchY){var t=app.touchX-e.originalEvent.changedTouches[0].clientX,n=app.touchY-e.originalEvent.changedTouches[0].clientY;console.log(t,n,app.touchX,app.touchY,e.originalEvent.changedTouches[0].clientX,e.originalEvent.changedTouches[0].clientY),app.touchX=null,app.touchY=null,Math.abs(t)<app.touchThreshold&&$("main").scrollLeft(app.mainScroll),app.mainScroll=null,app.snap.content.swipe(t,n,$(this).scrollTop())}})},swipe:function(e,t,n){e&&t&&(Math.abs(e)>Math.abs(t)?e<0?e<-Math.abs(app.swipeThreshold)&&(app.DEBUG&&console.log("content swipe left"),app.snap.previous()):e>Math.abs(app.swipeThreshold)&&(app.DEBUG&&console.log("content swipe right"),app.snap.next()):t<0?t<-Math.abs(app.swipeThreshold)&&(app.DEBUG&&console.log("content swipe up"),n<2&&app.snap.cover.show(!0)):t>Math.abs(app.swipeThreshold)&&app.DEBUG&&console.log("content swipe down"))}},cover:{show:function(e){var t=app.snap.getCurrent();$(t.cover).hasClass("over")&&(t.content?(app.snap.content.stop(t),$(t.content).stop().animate({scrollTop:0},app.transitionSpeed),$(t.cover).animate({top:"0%"},app.transitionSpeed,function(){$(this).removeClass("over").removeAttr("style")})):$(t.cover).removeAttr("style").removeClass("over"),console.log("show cover: ",e),e===!0&&app.snap.play(t))},eventListeners:function(){$(".snap-cover").on("touchstart",function(e){app.startedTF&&(app.touchX=e.originalEvent.touches[0].clientX,app.touchY=e.originalEvent.touches[0].clientY,app.mainScroll=app.getScroll())}).on("touchmove",function(e){if(app.touchX&&app.touchY){var t=app.touchX-e.originalEvent.touches[0].clientX,n=app.touchY-e.originalEvent.touches[0].clientY;if(Math.abs(t)>Math.abs(n))$("main").scrollLeft(app.getScroll()+t);else{var o=app.snap.getCurrent();o.content&&!$(o.cover).hasClass("over")&&n>0&&(n=n/$("main").height()*100,$(o.cover).css({top:n*-1+"%"}))}e.preventDefault()}}).on("touchend",function(e){if(app.touchX||app.touchY){var t=app.touchX-e.originalEvent.changedTouches[0].clientX,n=app.touchY-e.originalEvent.changedTouches[0].clientY;if(console.log(t,n,app.touchX,app.touchY,e.originalEvent.changedTouches[0].clientX,e.originalEvent.changedTouches[0].clientY),app.touchX=null,app.touchY=null,Math.abs(t)<app.touchThreshold&&$("main").scrollLeft(app.mainScroll),Math.abs(n)<app.touchThreshold){var o=app.snap.getCurrent();$(o.cover).animate({top:"0%"},app.transitionSpeed,function(){$(this).removeAttr("style").removeClass("over")})}app.mainScroll=null,app.snap.cover.swipe(t,n)}})},swipe:function(e,t){(e||t)&&(console.log(e,t),Math.abs(e)>Math.abs(t)?e<0?e<-Math.abs(app.swipeThreshold)&&(app.DEBUG&&console.log("swipe left"),app.snap.previous()):e>Math.abs(app.swipeThreshold)&&(app.DEBUG&&console.log("swipe right"),app.snap.next()):t<0?t<-Math.abs(app.swipeThreshold)&&app.DEBUG&&console.log("swipe up"):t>Math.abs(app.swipeThreshold)&&(app.DEBUG&&console.log("swipe down"),app.snap.content.show()))}}},$(document).ready(function(){app.init()});
//# sourceMappingURL=main.min.js.map
