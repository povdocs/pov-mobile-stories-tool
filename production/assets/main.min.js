function createCORSRequest(e,t){var n=new XMLHttpRequest;return"withCredentials"in n?n.open(e,t,!0):"undefined"!=typeof XDomainRequest?(n=new XDomainRequest,n.open(e,t)):n=null,n}function AssetManager(){this.DEBUG=!0,this.successCount=0,this.errorCount=0,this.cache={},this.downloadQueue=[],this.inQueue={}}AssetManager.prototype.queueDownload=function(e){this.downloadQueue.push(e)},AssetManager.prototype.constructor=function(e,t){"undefined"!=typeof e&&(this.downloadQueue=e),0===this.downloadQueue.length&&"undefined"!=typeof t&&t();for(var n=this,a=0;a<this.downloadQueue.length;a++){var o=this.downloadQueue[a];if("image"==o.type)this.downloadImage(o.path,function(e,a){n.cache[e]=a,n.isDone()&&t()});else if("audio"==o.type)this.downloadAudio(o.path,function(e,a){n.cache[e]=a,n.isDone()&&t()});else{if("video"!=o.type)continue;this.downloadVideo(o.path,function(e,a){n.cache[e]=a,n.isDone()&&t()})}}},AssetManager.prototype.downloadImage=function(e,t){var n=new Image,a=this;a.DEBUG&&console.log("IMAGE DOWNLOADING: ",e),n.addEventListener("load",function(){a.successCount+=1,a.DEBUG&&console.log("IMAGE DOWNLOADED: ",e),t(e,n)},!1),n.addEventListener("error",function(){a.errorCount+=1},!1),n.src=e},AssetManager.prototype.downloadAudio=function(e,t){var n=new Audio,a=this;a.DEBUG&&console.log("AUDIO DOWNLOADING: ",e),n.addEventListener("load",function(){a.DEBUG&&console.log("AUDIO DOWNLOADED: ",e),a.successCount+=1,t(e,n)},!1),n.addEventListener("error",function(){a.errorCount+=1},!1),n.src=e},AssetManager.prototype.downloadVideo=function(e,t){var n=null,a=this,o=createCORSRequest("GET",e);if(!o)throw new Error("CORS not supported");a.DEBUG&&console.log("VIDEO DOWNLOADING: ",e),o.responseType="blob",o.addEventListener("load",function(){a.DEBUG&&console.log("VIDEO DOWNLOADED: ",e),a.successCount+=1,window.URL=window.URL||window.webkitURL,n=window.URL.createObjectURL(this.response),t(e,n)},!1),o.addEventListener("error",function(){a.errorCount+=1},!1),o.addEventListener("progress",function(t){a.progressCount(e,t.loaded,t.total)}),o.send()},AssetManager.prototype.isDone=function(){return this.downloadQueue.length==this.successCount+this.errorCount},AssetManager.prototype.progress=function(){var e=0,t=0;for(var n in this.inQueue)this.inQueue.hasOwnProperty(n)&&(e+=this.inQueue[n].progress,t+=this.inQueue[n].total);return e/t*100},AssetManager.prototype.getAsset=function(e){return this.cache[e]},AssetManager.prototype.updateProgress=function(e,t){if(t.lengthComputable){var n=t.loaded/t.total;parentThis.DEBUG&&console.log(e,n)}},AssetManager.prototype.progressCount=function(e,t,n){this.inQueue[e]={progress:event.loaded,total:event.total}};var assetManager=new AssetManager,app={DEBUG:!0,snapFile:"assets/snap.json",touchX:null,touchY:null,video:null,audio:null,canvas:null,assets:[],allAssets:[],snaps:[],appReady:!1,init:function(){app.readFile(),app.start()},start:function(){setTimeout(function(){app.eventListener(),app.downloadAssets()},1e3)},eventListener:function(){$("#startStory").on("click",function(){for(var e=0,t=app.snaps.length;e<t;e++){var n=app.snaps[e];n.video.length&&(app.playObj(n.video),app.stopObj(n.video)),n.audio.length&&(app.playObj(n.audio),app.stopObj(n.audio))}app.nextSnap()}),$("section").on("mousedown",function(e){$(this).hasClass("snap")&&(app.touchX=e.clientX,app.touchY=e.clientY)}).on("mousemove",function(e){if(app.touchX&&app.touchY){var t=app.touchX-e.clientX,n=app.touchY-e.clientY;app.swipe(t,n),app.touchX=null,app.touchY=null}}).on("touchstart",function(e){$(this).hasClass("snap")&&(app.touchX=e.originalEvent.touches[0].clientX,app.touchY=e.originalEvent.touches[0].clientY)}).on("touchmove",function(e){if(app.touchX&&app.touchY){var t=app.touchX-e.originalEvent.touches[0].clientX,n=app.touchY-e.originalEvent.touches[0].clientY;app.swipe(t,n),app.touchX=null,app.touchY=null}}),$(document).on("keydown",function(e){37==e.keyCode?app.previousSnap():38==e.keyCode?app.backToCover():39==e.keyCode?app.nextSnap():40==e.keyCode&&app.snapContent()})},readFile:function(){$.getJSON(app.snapFile,function(e){for(var t=1,n=e.length;t<=n;t++)app.createSnap(t,e[t-1]),app.indexSnap(t)})},createSnap:function(e,t){var n=$('<section id="snap'+e+'" class="snap"></section>'),a=$('<div class="snap-cover"></div>'),o=$('<div class="snap-content"></div>');t.cover.image&&a.append('<img class="snap-cover-image" data-asset-id="'+app.addAssetManager("image",t.cover.image)+'" src="" alt="" width="100%" height="">'),t.cover.video&&a.append('<video class="snap-cover-video" data-asset-id="'+app.addAssetManager("video",t.cover.video)+'" loop muted><source src="" type="video/mp4"></video>'),t.cover.audio&&a.append('<audio class="snap-cover-audio" loop muted><source src="'+t.cover.audio+'" type="audio/mp3"></audio>'),"html"==t.content.type&&o.html(t.content.src),a.appendTo(n),o.appendTo(n),n.appendTo("main")},indexSnap:function(e){var t={video:$("#snap"+e+" .snap-cover video"),audio:$("#snap"+e+" .snap-cover audio"),cover:$("#snap"+e+" .snap-cover"),content:$("#snap"+e+" .snap-content")};app.snaps.push(t)},addAssetManager:function(e,t){var n=app.assets.indexOf(t);return n<0?(app.allAssets.push({type:e,path:t}),app.assets.push(t),app.allAssets.length-1):n},downloadAssets:function(){var e=setInterval(function(){var t=assetManager.progress();t<100?$(".progress-bar").css({width:t+"%"}):clearInterval(e)},100);assetManager.constructor(app.allAssets,function(){for(var e=0;e<app.allAssets.length;e++){var t=app.allAssets[e],n=assetManager.getAsset(t.path);if("audio"==t.type||"video"==t.type)$('[data-asset-id="'+e+'"]').each(function(){$(this).get(0).src=n,$(this).children().get(0).src=n});else{if("image"!=t.type)continue;$('[data-asset-id="'+e+'"]').src=t.path}}app.appReady=!0,$("#startStory").show(),$("#loading").hide()})},swipe:function(e,t){e&&t&&(Math.abs(e)>Math.abs(t)?e<0?(console.log("swipe left"),app.previousSnap()):(console.log("swipe right"),app.nextSnap()):t<0?console.log("swipe up"):console.log("swipe down"))},getScroll:function(){var e=$("main").attr("data-scroll");return e=e?parseInt(e):0,e%$("main").width()!==0&&(e-=e%$("main").width()),e},getCurrentSnap:function(){var e=parseInt($("main").attr("data-snap"));return e<1?null:app.getSnap(e)},getSnap:function(e){return app.snaps[e-1]},nextSnap:function(){var e=$("section").width(),t=$("section.snap").length,n=app.getScroll()+e;n<=e*t&&$("main").stop().animate({scrollLeft:n},500,function(){var t=n/e;$("main").attr({"data-scroll":n,"data-snap":t}),app.stopSnap(app.getSnap(t-1)),app.playSnap(app.getSnap(t))})},previousSnap:function(){var e=$("section").width(),t=app.getScroll()-e;t>=0&&$("main").stop().animate({scrollLeft:t},500,function(){var n=t/e;$("main").attr({"data-scroll":t,"data-snap":n}),app.stopSnap(app.getSnap(n+1)),app.playSnap(app.getSnap(n))})},snapContent:function(){var e=app.getCurrentSnap();e.cover.addClass("over")},backToCover:function(){var e=app.getCurrentSnap();e.content.stop().animate({scrollTop:0},1e3,function(){e.cover.removeClass("over")})},stopSnap:function(e){return!!e&&(e.video.length&&app.stopObj(e.video),void(e.audio.length&&app.stopObj(e.audio)))},playSnap:function(e){return!!e&&(e.video.length&&app.playObj(e.video),void(e.audio.length&&app.playObj(e.audio)))},stopObj:function(e){return!!e&&void e.animate({volume:0},500,function(){e.get(0).pause(),e.currentTime=0,e.get(0).volume=1,e.prop("muted",!0)})},playObj:function(e){return!!e&&(e.prop("muted",!1),e.currentTime=0,void e.get(0).play())}};$(document).ready(function(){app.init()});
//# sourceMappingURL=main.min.js.map
